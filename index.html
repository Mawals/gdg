
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>تسجيل غياب — رابط المعلّم</title>
</head>
<body>
  <h2>تسجيل غياب الطلاب</h2>
  <div>
    <label>اسم المعلم: <input id="teacherName" /></label>
    <label>الصف: 
      <select id="gradeSelect">
        <option value="5">5</option><option value="6">6</option>
        <option value="7">7</option><option value="8">8</option>
        <option value="9">9</option><option value="10">10</option>
        <option value="11">11</option><option value="12">12</option>
      </select>
    </label>
    <label>الشعبة:
      <select id="sectionSelect">
        <option value="1">1</option><option value="2">2</option>
        <option value="3">3</option><option value="4">4</option>
        <option value="5">5</option>
      </select>
    </label>
    <button onclick="loadStudents()">عرض الأسماء</button>
  </div>
  <table border="1" style="margin-top:20px;width:100%;">
    <thead>
      <tr><th>#</th><th>الاسم</th><th>الهاتف</th><th>الحالة</th></tr>
    </thead>
    <tbody id="studentsBody">
      <tr><td colspan="4">يرجى اختيار الصف والشعبة</td></tr>
    </tbody>
  </table>

<script>
const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRsicYUB3Mg9CjCulq7G9XjJaIv1oUrC2iYsOjCentY--D-o-skaLagx2S2-6a3AG5lJYOhBXtxNgpy/pub?gid=626465739&single=true&output=csv';

async function loadStudents() {
  const grade = document.getElementById('gradeSelect').value;
  const section = document.getElementById('sectionSelect').value;
  const res = await fetch(SHEET_URL);
  const text = await res.text();
  const rows = text.trim().split('\n').slice(1); // remove header
  const filtered = rows.map(r => r.split(',')).filter(c => c[3] === grade && c[4] === section);

  const body = document.getElementById('studentsBody');
  body.innerHTML = '';
  filtered.forEach((cols, i) => {
    const row = document.createElement('tr');
    row.innerHTML = `<td>${i+1}</td><td>${cols[1]}</td><td>${cols[0]}</td><td><button onclick="toggle(this)">حاضر</button></td>`;
    body.appendChild(row);
  });
}

function toggle(btn) {
  btn.textContent = (btn.textContent === 'حاضر') ? 'غائب' : 'حاضر';
  btn.style.backgroundColor = (btn.textContent === 'غائب') ? '#dc2626' : '#16a34a';
  btn.style.color = '#fff';
}
</script>
</body>
</html>
