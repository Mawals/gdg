<script>
const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRpYkLDu5kwHXqoqZ9WPonUBDVrrbF3eo4hSAiuQosDnrYcrepDiSvTs6o2gBFrAQ/pub?gid=626465739&single=true&output=csv';
const EXPORT_WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbw-WH146HgZOv84R9Pb5e9QtXqXKDzc9pNZ2pAJu0N2mxz9HikwwvTaDsufqnMl23lK/exec';
const $ = selector => document.querySelector(selector);
const state = { students: [], attendance: {} };

function exportToGoogleSheet() {
  const absents = state.students.filter(s => state.attendance[s.id] === false);
  if (!absents.length) return alert('ูุง ููุฌุฏ ุบูุงุจ ูุชุตุฏูุฑู.');

  const teacher = $('#teacherName').value.trim() || 'ุงููุนูู';
  const grade = $('#gradeSelect').value;
  const section = $('#sectionSelect').value;
  const today = new Date().toLocaleDateString('ar-EG');

  const rows = absents.map((s, i) => ({
    serial: i + 1,
    phone: formatPhoneOM(s.phone),
    name: s.name,
    message: `ููู ุฃูุฑ ุงูุทุงูุจ ${s.name}ุ ูุนูููู ุจุบูุงุจ ุงุจููู ุนู ุงูุตู ${grade}/${section} ุจุชุงุฑูุฎ ${today}. โ ${teacher}`
  }));

  fetch(EXPORT_WEBAPP_URL, {
    method: 'POST',
    mode: 'no-cors',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(rows)
  }).then(() => {
    alert('ุชู ุฅุฑุณุงู ุงูุบูุงุจ ุฅูู ุฌุฏูู Google ุจูุฌุงุญ.');
  }).catch(err => {
    alert('ูุดู ุงูุฅุฑุณุงู ุฅูู ุงูุดูุช');
    console.error(err);
  });
}
</script>
<button onclick="exportToGoogleSheet()">๐ค ุฅุฑุณุงู ุฅูู Google Sheets</button>